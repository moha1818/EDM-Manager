<%@ page language="java" pageEncoding="UTF-8"%>
<%@ taglib prefix="t" tagdir="/WEB-INF/tags"%>
<%@taglib uri="https://gttown.cn/tags" prefix="gttown"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<t:template plugin="date,validate">
	<jsp:attribute name="header">
	<title>邮件群发</title>
	<script type="text/javascript" src="/static/jquery/jquery.form.js"></script>
</jsp:attribute>

	<jsp:attribute name="body">
			
<div class="col-sm-12">
     <div class="tabbable">			
			<!--企业列表-->
			<button onclick="sendEmail()" class="btn btn-xs btn-info">发送邮件</button>
		<form action="/email/list" id="pageForm" method="post">
		<!-- search begin -->
   		 <div class="nav nav-tabs padding-12 tab-color-blue background-blue mt20 form-horizontal">
			企业名称：<input id="enterpriseName" name="enterpriseName" value="${ param.enterpriseName}" onkeyup="this.value=this.value.replace(/^\s*|\s*$/g,'')"/>
			会员等级：
			      <select class="select" id="memberLevel" name="memberLevel">
							<option value="">请选择</option>
							<option value="0">普通会员</option>
							<option value="1">年费会员</option>
			      </select>
			<span>邮件时间：</span><input type="text" name="emailTime_begin" value="${param.emailTime_begin }" class="date-picker"/>
	  							<span><i class="fa fa-exchange"></i></span>
	  					   <input type="text" name="emailTime_end" value="${param.emailTime_end }" class="date-picker"/>
				<input type="submit" value="查询" class="btn btn-xs btn-info" />
			</div>
			<!-- search end -->
				<div class="space-12"></div>

				<div class="table-responsive">											
					<table class="table table-striped table-bordered table-hover">						
						<thead>
							<tr>
							    <th width="1%"><input type="checkbox" id="selectAll"></th>
								<th width="20%">企业名称 </th>
								<th width="16%">企业邮箱</th>
								<th width="20%">英文名称  </th>
								<th width="8%">法定代表人  </th>
								<th width="7%">入驻时间 </th>
								<%--<th width="6%">会员等级</th>--%>
								<th>最后邮件时间</th>
							</tr>
							</thead>
							<tbody>
							<c:forEach items="${pageInfo.list }" var="v">
							
							<tr><!-- 
							    <td><%-- <input s="${v.status }" value="${v.id }" type="checkbox" id="${v.id }" name="selectedItems" class="toRecoveryButton"> --%>
							    	<label class="pos-rel">
							         <input s="${v.status }" value="${v.id }" type="radio" id="${v.id }" name="selectedItems" class="toRecoveryButton ace"> 
									 <span class="lbl"></span>
									</label>
							    </td> -->
							    <td>
							    	<input s="${v.status }" value="${v.id }" type="checkbox" id="${v.id }" name="selectedItems" class="toRecoveryButton">
							    </td>
							    <td>${v.cnEnterpriseName }</td>
							    <!-- 这里邮箱 -->
							    <td>${v.email }</td>
							    <!-- 这里邮箱 -->
								<td>${v.enEnterpriseName}</td>
								<td>${v.legalRepresentative }</td>
								<td>${fn:substring(gttown:UTCTime(v.createTime,"dateTime",0),0,10)}</td>								
								<%--<td>--%>
								    <%--<c:if test="${v.memberLevelId=='1' }">年费会员</c:if>--%>
								    <%--<c:if test="${v.memberLevelId!='1' }">普通会员</c:if>--%>
								<%--</td>--%>
								<!-- 最后邮件时间 -->
								<c:if test="${empty v.lastEmailTime}">
									<td align="center">-</td>
								</c:if>
								<c:if test="${not empty v.lastEmailTime}">
									<td><fmt:formatDate value="${v.lastEmailTime}" type="both"/></td>
								</c:if>
								<!-- 最后邮件时间 -->
							</tr>
							
							</c:forEach>

						    </tbody>
					</table>
			   </div>

			
		       <gttown:Page page="${pageInfo }" isTotalShow="true" />
            </form>
		</div>
</div>
     
     			
</jsp:attribute>

	<jsp:attribute name="js">
	<script type="text/javascript" src="/static/bootstrap/js/bootstrapq.js"></script>
		<!-- page specific plugin scripts -->
	<script src="/static/enterprises/js/jquery-ui.custom.js"></script>
	<script src="/static/enterprises/js/jquery.ui.touch-punch.js"></script>
	<script src="/static/enterprises/js/markdown.js"></script>
	<script src="/static/enterprises/js/bootstrap-markdown.js"></script>
	<script src="/static/enterprises/js/jquery.hotkeys.js"></script>
	<script src="/static/enterprises/js/bootstrap-wysiwyg.js"></script>
	<script src="/static/enterprises/js/bootbox.js"></script>
		<!-- ace scripts -->
	<script src="/static/enterprises/js/elements.scroller.js"></script>
	<script src="/static/enterprises/js/elements.colorpicker.js"></script>
	<script src="/static/enterprises/js/elements.fileinput.js"></script>
	<script src="/static/enterprises/js/elements.typeahead.js"></script>
	<script src="/static/enterprises/js/elements.wysiwyg.js"></script>
	<script src="/static/enterprises/js/elements.spinner.js"></script>
	<script src="/static/enterprises/js/elements.treeview.js"></script>
	<script src="/static/enterprises/js/elements.wizard.js"></script>
	<script src="/static/enterprises/js/elements.aside.js"></script>
	<script src="/static/enterprises/js/ace.js"></script>
	<script src="/static/enterprises/js/ace.ajax-content.js"></script>
	<script src="/static/enterprises/js/ace.touch-drag.js"></script>
	<script src="/static/enterprises/js/ace.sidebar.js"></script>
	<script src="/static/enterprises/js/ace.sidebar-scroll-1.js"></script>
	<script src="/static/enterprises/js/ace.submenu-hover.js"></script>
	<script src="/static/enterprises/js/ace.widget-box.js"></script>
	<script src="/static/enterprises/js/ace.settings.js"></script>
	<script src="/static/enterprises/js/ace.settings-rtl.js"></script>
	<script src="/static/enterprises/js/ace.settings-skin.js"></script>
	<script src="/static/enterprises/js/ace.widget-on-reload.js"></script>
	<script src="/static/enterprises/js/ace.searchbox-autocomplete.js"></script>	
		<script type="text/javascript">
		
			$(function(){
				//时间控件 
				$('.date-picker').datepicker({
	                autoclose: true,
	                language : 'zh-CN',
	                format:'yyyy-mm-dd',
	                todayHighlight: true
	            });
				
				 $('#memberLevel').val("${param.memberLevel}");
		         $('#memberStatus').val("${param.memberStatus}");
		         
		         $('#selectAll').change(function(){
		        	 var $allItems = $("input[name='selectedItems']");
		        	 if($(this).is(":checked")){
						$allItems.each(function(index){
							$(this).prop("checked","checked");
						});
		        	 }else{
		        		//alert("没有选中");
		        		 $allItems.each(function(index){
								$(this).prop("checked",null);
							});
		        	 }
		         });
			});
			
			var sendEmail = function(){
				var emails = [];
				var ids = [];
				//检测所有点击
				$("input[name='selectedItems']").each(function(index){
					if($(this).is(":checked")){
						//如果被选中，说明这个邮箱需要发邮件
						email = $(this).parent().next().next().text();
						id = $(this).val();
						ids.push(id);
						emails.push(email);
					}else{
						
					}
				});
				
				if(emails.length == 0){
					//没有选择目标邮箱
					alert("请选择需要发邮件的邮箱!");
				}else{
					var emails_value = emails.join(",");
					var ids_value = ids.join(",");
				
				
				 	//弹出邮件编辑页面
					bootstrapQ.dialog({
						url : '/email/showEdit?emails='+ emails_value +'&ids='+ids_value,
						title : '编辑邮件内容',
						head : false,
						backdrop : false,
						foot : false,
						big : false,
						mstyle:'width:1000px;'
						}, function() {
							//window.location.reload();
							//alert("hah");
							// true关闭窗口，false不关闭
						
						return false;
					}); 
				}
			}
		</script>
			
	</jsp:attribute>
</t:template>